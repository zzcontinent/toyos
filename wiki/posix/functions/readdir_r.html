<!-- Copyright 2001-2013 IEEE and The Open Group, All Rights Reserved -->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="HTML Tidy, see www.w3.org">
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link type="text/css" rel="stylesheet" href="style.css"><!-- Generated by The Open Group's rhtm tool v1.2.4 -->
<!-- Copyright (c) 2001-2013 The Open Group, All Rights Reserved -->
<title>readdir</title>
</head>
<body bgcolor="white">
<div class="NAVHEADER">
<table summary="Header navigation table" class="nav" width="100%" border="0" cellpadding="0" cellspacing="0">
<tr class="nav">
<td class="nav" width="15%" align="left" valign="bottom"><a href="../functions/read.html" accesskey="P">&lt;&lt;&lt; Previous</a></td>
<td class="nav" width="70%" align="center" valign="bottom"><a href="contents.html">Home</a></td>
<td class="nav" width="15%" align="right" valign="bottom"><a href="../functions/readlink.html" accesskey="N">Next
&gt;&gt;&gt;</a></td>
</tr>
</table>

<hr align="LEFT" width="100%">
</div>

<script type="text/javascript" language="JavaScript" src="../jscript/codes.js">
</script>

<basefont size="3"> 

<center><font size="2">The Open Group Base Specifications Issue 7, 2018 edition<br>
IEEE Std 1003.1-2017 (Revision of IEEE Std 1003.1-2008)<br>
Copyright &copy; 2001-2018 IEEE and The Open Group</font></center>

<hr size="2" noshade>
<a name="top"></a> <a name="readdir"></a> <a name="tag_16_475"></a><!-- readdir -->
 

<h4 class="mansect"><a name="tag_16_475_01"></a>NAME</h4>

<blockquote>readdir, readdir_r - read a directory</blockquote>

<h4 class="mansect"><a name="tag_16_475_02"></a>SYNOPSIS</h4>

<blockquote class="synopsis">
<p><code><tt>#include &lt;<a href="../basedefs/dirent.h.html">dirent.h</a>&gt;<br>
<br>
 struct dirent *readdir(DIR *</tt><i>dirp</i><tt>);<br>
 int readdir_r(DIR *restrict</tt> <i>dirp</i><tt>, struct dirent *restrict</tt> <i>entry</i><tt>,<br>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; struct dirent **restrict</tt> <i>result</i><tt>);<br>
</tt></code></p>
</blockquote>

<h4 class="mansect"><a name="tag_16_475_03"></a>DESCRIPTION</h4>

<blockquote>
<p>The type <b>DIR</b>, which is defined in the <a href="../basedefs/dirent.h.html"><i>&lt;dirent.h&gt;</i></a> header, represents
a <i>directory stream</i>, which is an ordered sequence of all the directory entries in a particular directory. Directory entries
represent files; files may be removed from a directory or added to a directory asynchronously to the operation of
<i>readdir</i>().</p>

<p>The <i>readdir</i>() function shall return a pointer to a structure representing the directory entry at the current position in
the directory stream specified by the argument <i>dirp</i>, and position the directory stream at the next entry. It shall return a
null pointer upon reaching the end of the directory stream. The structure <b>dirent</b> defined in the <a href=
"../basedefs/dirent.h.html"><i>&lt;dirent.h&gt;</i></a> header describes a directory entry. The value of the structure's
<i>d_ino</i> member shall be set to the file serial number of the file named by the <i>d_name</i> member. If the <i>d_name</i>
member names a symbolic link, the value of the <i>d_ino</i> member shall be set to the file serial number of the symbolic link
itself.</p>

<p>The <i>readdir</i>() function shall not return directory entries containing empty names. If entries for dot or dot-dot exist,
one entry shall be returned for dot and one entry shall be returned for dot-dot; otherwise, they shall not be returned.</p>

<p>The application shall not modify the structure to which the return value of <i>readdir</i>() points, nor any storage areas
pointed to by pointers within the structure. The returned pointer, and pointers within the structure, might be invalidated or the
structure or the storage areas might be overwritten by a subsequent call to <i>readdir</i>() on the same directory stream. They
shall not be affected by a call to <i>readdir</i>() on a different directory stream. The returned pointer, and pointers within the
structure, might also be invalidated if the calling thread is terminated.</p>

<p>If a file is removed from or added to the directory after the most recent call to <a href=
"../functions/opendir.html"><i>opendir</i>()</a> or <a href="../functions/rewinddir.html"><i>rewinddir</i>()</a>, whether a
subsequent call to <i>readdir</i>() returns an entry for that file is unspecified.</p>

<p>The <i>readdir</i>() function may buffer several directory entries per actual read operation; <i>readdir</i>() shall mark for
update the last data access timestamp of the directory each time the directory is actually read.</p>

<p>After a call to <a href="../functions/fork.html"><i>fork</i>()</a>, either the parent or child (but not both) may continue
processing the directory stream using <i>readdir</i>(), <a href="../functions/rewinddir.html"><i>rewinddir</i>()</a>, <sup>[<a
href="javascript:open_code('XSI')">XSI</a>]</sup> <img src="../images/opt-start.gif" alt="[Option Start]" border="0"> &nbsp;or <a
href="../functions/seekdir.html"><i>seekdir</i>()</a>. <img src="../images/opt-end.gif" alt="[Option End]" border="0"> If both the
parent and child processes use these functions, the result is undefined.</p>

<p>The <i>readdir</i>() function need not be thread-safe.</p>

<p>Applications wishing to check for error situations should set <i>errno</i> to 0 before calling <i>readdir</i>(). If <i>errno</i>
is set to non-zero on return, an error occurred.</p>

<p>The <i>readdir_r</i>() function shall initialize the <b>dirent</b> structure referenced by <i>entry</i> to represent the
directory entry at the current position in the directory stream referred to by <i>dirp</i>, store a pointer to this structure at
the location referenced by <i>result</i>, and position the directory stream at the next entry.</p>

<p>The storage pointed to by <i>entry</i> shall be large enough for a <b>dirent</b> with an array of <b>char</b> <i>d_name</i>
members containing at least {NAME_MAX}+1 elements.</p>

<p>Upon successful return, the pointer returned at *<i>result</i> shall have the same value as the argument <i>entry</i>. Upon
reaching the end of the directory stream, this pointer shall have the value NULL.</p>

<p>The <i>readdir_r</i>() function shall not return directory entries containing empty names.</p>

<p>If a file is removed from or added to the directory after the most recent call to <a href=
"../functions/opendir.html"><i>opendir</i>()</a> or <a href="../functions/rewinddir.html"><i>rewinddir</i>()</a>, whether a
subsequent call to <i>readdir_r</i>() returns an entry for that file is unspecified.</p>

<p>The <i>readdir_r</i>() function may buffer several directory entries per actual read operation; <i>readdir_r</i>() shall mark
for update the last data access timestamp of the directory each time the directory is actually read.</p>
</blockquote>

<h4 class="mansect"><a name="tag_16_475_04"></a>RETURN VALUE</h4>

<blockquote>
<p>Upon successful completion, <i>readdir</i>() shall return a pointer to an object of type <b>struct dirent</b>. When an error is
encountered, a null pointer shall be returned and <i>errno</i> shall be set to indicate the error. When the end of the directory is
encountered, a null pointer shall be returned and <i>errno</i> is not changed.</p>

<p>If successful, the <i>readdir_r</i>() function shall return zero; otherwise, an error number shall be returned to indicate the
error.</p>
</blockquote>

<h4 class="mansect"><a name="tag_16_475_05"></a>ERRORS</h4>

<blockquote>
<p>These functions shall fail if:</p>

<dl compact>
<dt>[EOVERFLOW]</dt>

<dd>One of the values in the structure to be returned cannot be represented correctly.</dd>
</dl>

<p>These functions may fail if:</p>

<dl compact>
<dt>[EBADF]</dt>

<dd>The <i>dirp</i> argument does not refer to an open directory stream.</dd>

<dt>[ENOENT]</dt>

<dd>The current position of the directory stream is invalid.</dd>
</dl>
</blockquote>

<hr>
<div class="box"><em>The following sections are informative.</em></div>

<h4 class="mansect"><a name="tag_16_475_06"></a>EXAMPLES</h4>

<blockquote>
<p>The following sample program searches the current directory for each of the arguments supplied on the command line.</p>

<pre>
<tt>#include &lt;dirent.h&gt;
#include &lt;errno.h&gt;
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
<br>
static void lookup(const char *arg)
{
    DIR *dirp;
    struct dirent *dp;
<br>
    if ((dirp = opendir(".")) == NULL) {
        perror("couldn't open '.'");
        return;
    }
<br>
    do {
        errno = 0;
        if ((dp = readdir(dirp)) != NULL) {
            if (strcmp(dp-&gt;d_name, arg) != 0)
                continue;
<br>
            (void) printf("found %s\n", arg);
            (void) closedir(dirp);
                return;
<br>
        }
    } while (dp != NULL);
<br>
    if (errno != 0)
        perror("error reading directory");
    else
        (void) printf("failed to find %s\n", arg);
    (void) closedir(dirp);
    return;
}
<br>
int main(int argc, char *argv[])
{
    int i;
    for (i = 1; i &lt; argc; i++)
        lookup(argv[i]);
    return (0);
}
</tt>
</pre>
</blockquote>

<h4 class="mansect"><a name="tag_16_475_07"></a>APPLICATION USAGE</h4>

<blockquote>
<p>The <i>readdir</i>() function should be used in conjunction with <a href="../functions/opendir.html"><i>opendir</i>()</a>, <a
href="../functions/closedir.html"><i>closedir</i>()</a>, and <a href="../functions/rewinddir.html"><i>rewinddir</i>()</a> to
examine the contents of the directory.</p>

<p>The <i>readdir_r</i>() function is thread-safe and shall return values in a user-supplied buffer instead of possibly using a
static data area that may be overwritten by each call.</p>
</blockquote>

<h4 class="mansect"><a name="tag_16_475_08"></a>RATIONALE</h4>

<blockquote>
<p>The returned value of <i>readdir</i>() merely <i>represents</i> a directory entry. No equivalence should be inferred.</p>

<p>Historical implementations of <i>readdir</i>() obtain multiple directory entries on a single read operation, which permits
subsequent <i>readdir</i>() operations to operate from the buffered information. Any wording that required each successful
<i>readdir</i>() operation to mark the directory last data access timestamp for update would disallow such historical
performance-oriented implementations.</p>

<p>When returning a directory entry for the root of a mounted file system, some historical implementations of <i>readdir</i>()
returned the file serial number of the underlying mount point, rather than of the root of the mounted file system. This behavior is
considered to be a bug, since the underlying file serial number has no significance to applications.</p>

<p>Since <i>readdir</i>() returns NULL when it detects an error and when the end of the directory is encountered, an application
that needs to tell the difference must set <i>errno</i> to zero before the call and check it if NULL is returned. Since the
function must not change <i>errno</i> in the second case and must set it to a non-zero value in the first case, a zero <i>errno</i>
after a call returning NULL indicates end-of-directory; otherwise, an error.</p>

<p>Routines to deal with this problem more directly were proposed:</p>

<pre>
<tt>int derror (</tt><i>dirp</i><tt>)
DIR *</tt><i>dirp</i><tt>;
<br>
void clearderr (</tt><i>dirp</i><tt>)
DIR *</tt><i>dirp</i><tt>;
</tt>
</pre>

<p>The first would indicate whether an error had occurred, and the second would clear the error indication. The simpler method
involving <i>errno</i> was adopted instead by requiring that <i>readdir</i>() not change <i>errno</i> when end-of-directory is
encountered.</p>

<p>An error or signal indicating that a directory has changed while open was considered but rejected.</p>

<p>The thread-safe version of the directory reading function returns values in a user-supplied buffer instead of possibly using a
static data area that may be overwritten by each call. Either the {NAME_MAX} compile-time constant or the corresponding <a href=
"../functions/pathconf.html"><i>pathconf</i>()</a> option can be used to determine the maximum sizes of returned pathnames.</p>
</blockquote>

<h4 class="mansect"><a name="tag_16_475_09"></a>FUTURE DIRECTIONS</h4>

<blockquote>
<p>None.</p>
</blockquote>

<h4 class="mansect"><a name="tag_16_475_10"></a>SEE ALSO</h4>

<blockquote>
<p><a href="../functions/closedir.html#"><i>closedir</i></a>, <a href="../functions/dirfd.html#"><i>dirfd</i></a>, <a href=
"../functions/exec.html#tag_16_111"><i><a href="../functions/exec.html">exec</a></i></a>, <a href=
"../functions/fdopendir.html#"><i>fdopendir</i></a>, <a href="../functions/fstatat.html#"><i>fstatat</i></a>, <a href=
"../functions/rewinddir.html#"><i>rewinddir</i></a>, <a href="../functions/symlink.html#"><i>symlink</i></a></p>

<p>XBD <a href="../basedefs/dirent.h.html"><i>&lt;dirent.h&gt;</i></a>, <a href=
"../basedefs/sys_types.h.html"><i>&lt;sys/types.h&gt;</i></a></p>
</blockquote>

<h4 class="mansect"><a name="tag_16_475_11"></a>CHANGE HISTORY</h4>

<blockquote>
<p>First released in Issue 2.</p>
</blockquote>

<h4 class="mansect"><a name="tag_16_475_12"></a>Issue 5</h4>

<blockquote>
<p>Large File Summit extensions are added.</p>

<p>The <i>readdir_r</i>() function is included for alignment with the POSIX Threads Extension.</p>

<p>A note indicating that the <i>readdir</i>() function need not be reentrant is added to the DESCRIPTION.</p>
</blockquote>

<h4 class="mansect"><a name="tag_16_475_13"></a>Issue 6</h4>

<blockquote>
<p>The <i>readdir_r</i>() function is marked as part of the Thread-Safe Functions option.</p>

<p>The Open Group Corrigendum U026/7 is applied, correcting the prototype for <i>readdir_r</i>().</p>

<p>The Open Group Corrigendum U026/8 is applied, clarifying the wording of the successful return for the <i>readdir_r</i>()
function.</p>

<p>The following new requirements on POSIX implementations derive from alignment with the Single UNIX Specification:</p>

<ul>
<li>
<p>The requirement to include <a href="../basedefs/sys_types.h.html"><i>&lt;sys/types.h&gt;</i></a> has been removed. Although <a
href="../basedefs/sys_types.h.html"><i>&lt;sys/types.h&gt;</i></a> was required for conforming implementations of previous POSIX
specifications, it was not required for UNIX applications.</p>
</li>

<li>
<p>A statement is added to the DESCRIPTION indicating the disposition of certain fields in <b>struct dirent</b> when an entry
refers to a symbolic link.</p>
</li>

<li>
<p>The [EOVERFLOW] mandatory error condition is added. This change is to support large files.</p>
</li>

<li>
<p>The [ENOENT] optional error condition is added.</p>
</li>
</ul>

<p>The APPLICATION USAGE section is updated to include a note on the thread-safe function and its avoidance of possibly using a
static data area.</p>

<p>The <b>restrict</b> keyword is added to the <i>readdir_r</i>() prototype for alignment with the ISO/IEC&nbsp;9899:1999
standard.</p>

<p>IEEE&nbsp;Std&nbsp;1003.1-2001/Cor&nbsp;1-2002, item XSH/TC1/D6/50 is applied, replacing the EXAMPLES section with a new
example.</p>
</blockquote>

<h4 class="mansect"><a name="tag_16_475_14"></a>Issue 7</h4>

<blockquote>
<p>Austin Group Interpretation 1003.1-2001 #059 is applied, updating the ERRORS section.</p>

<p>Austin Group Interpretation 1003.1-2001 #156 is applied.</p>

<p>The <i>readdir_r</i>() function is moved from the Thread-Safe Functions option to the Base.</p>

<p>Changes are made related to support for finegrained timestamps.</p>

<p>The value of the <i>d_ino</i> member is no longer unspecified for symbolic links.</p>

<p>SD5-XSH-ERN-193 is applied.</p>

<p>POSIX.1-2008, Technical Corrigendum 1, XSH/TC1-2008/0486 [75] is applied.</p>

<p>POSIX.1-2008, Technical Corrigendum 2, XSH/TC2-2008/0304 [656] is applied.</p>
</blockquote>

<div class="box"><em>End of informative text.</em></div>

<hr>
<p>&nbsp;</p>

<a href="#top"><span class="topOfPage">return to top of page</span></a><br>
<hr size="2" noshade>
<center><font size="2">UNIX &reg; is a registered Trademark of The Open Group.<br>
POSIX &reg; is a registered Trademark of The IEEE.<br>
Copyright &copy; 2001-2018 IEEE and The Open Group, All Rights Reserved<br>
[ <a href="../mindex.html">Main Index</a> | <a href="../basedefs/contents.html">XBD</a> | <a href=
"../functions/contents.html">XSH</a> | <a href="../utilities/contents.html">XCU</a> | <a href="../xrat/contents.html">XRAT</a>
]</font></center>

<hr size="2" noshade>
<div class="NAVHEADER">
<table summary="Header navigation table" class="nav" width="100%" border="0" cellpadding="0" cellspacing="0">
<tr class="nav">
<td class="nav" width="15%" align="left" valign="bottom"><a href="../functions/read.html" accesskey="P">&lt;&lt;&lt; Previous</a></td>
<td class="nav" width="70%" align="center" valign="bottom"><a href="contents.html">Home</a></td>
<td class="nav" width="15%" align="right" valign="bottom"><a href="../functions/readlink.html" accesskey="N">Next
&gt;&gt;&gt;</a></td>
</tr>
</table>

<hr align="LEFT" width="100%">
</div>
</body>
</html>

