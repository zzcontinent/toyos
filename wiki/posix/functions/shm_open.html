<!-- Copyright 2001-2013 IEEE and The Open Group, All Rights Reserved -->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="HTML Tidy, see www.w3.org">
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link type="text/css" rel="stylesheet" href="style.css"><!-- Generated by The Open Group's rhtm tool v1.2.4 -->
<!-- Copyright (c) 2001-2013 The Open Group, All Rights Reserved -->
<title>shm_open</title>
</head>
<body bgcolor="white">
<div class="NAVHEADER">
<table summary="Header navigation table" class="nav" width="100%" border="0" cellpadding="0" cellspacing="0">
<tr class="nav">
<td class="nav" width="15%" align="left" valign="bottom"><a href="../functions/setvbuf.html" accesskey="P">&lt;&lt;&lt;
Previous</a></td>
<td class="nav" width="70%" align="center" valign="bottom"><a href="contents.html">Home</a></td>
<td class="nav" width="15%" align="right" valign="bottom"><a href="../functions/shm_unlink.html" accesskey="N">Next
&gt;&gt;&gt;</a></td>
</tr>
</table>

<hr align="LEFT" width="100%">
</div>

<script type="text/javascript" language="JavaScript" src="../jscript/codes.js">
</script>

<basefont size="3"> 

<center><font size="2">The Open Group Base Specifications Issue 7, 2018 edition<br>
IEEE Std 1003.1-2017 (Revision of IEEE Std 1003.1-2008)<br>
Copyright &copy; 2001-2018 IEEE and The Open Group</font></center>

<hr size="2" noshade>
<a name="top"></a> <a name="shm_open"></a> <a name="tag_16_533"></a><!-- shm_open -->
 

<h4 class="mansect"><a name="tag_16_533_01"></a>NAME</h4>

<blockquote>shm_open - open a shared memory object (<b>REALTIME</b>)</blockquote>

<h4 class="mansect"><a name="tag_16_533_02"></a>SYNOPSIS</h4>

<blockquote class="synopsis">
<div class="box"><code><tt><sup>[<a href="javascript:open_code('SHM')">SHM</a>]</sup> <img src="../images/opt-start.gif" alt=
"[Option Start]" border="0"> #include &lt;<a href="../basedefs/sys_mman.h.html">sys/mman.h</a>&gt;<br>
<br>
 int shm_open(const char *</tt><i>name</i><tt>, int</tt> <i>oflag</i><tt>, mode_t</tt> <i>mode</i><tt>); <img src=
"../images/opt-end.gif" alt="[Option End]" border="0"></tt></code></div>

<tt><br>
</tt></blockquote>

<h4 class="mansect"><a name="tag_16_533_03"></a>DESCRIPTION</h4>

<blockquote>
<p>The <i>shm_open</i>() function shall establish a connection between a shared memory object and a file descriptor. It shall
create an open file description that refers to the shared memory object and a file descriptor that refers to that open file
description. The file descriptor shall be allocated as described in <a href="../functions/V2_chap02.html#tag_15_14"><i>File
Descriptor Allocation</i></a>, and can be used by other functions to refer to that shared memory object. The <i>name</i> argument
points to a string naming a shared memory object. It is unspecified whether the name appears in the file system and is visible to
other functions that take pathnames as arguments. The <i>name</i> argument conforms to the construction rules for a pathname,
except that the interpretation of &lt;slash&gt; characters other than the leading &lt;slash&gt; character in <i>name</i> is
implementation-defined, and that the length limits for the <i>name</i> argument are implementation-defined and need not be the same
as the pathname limits {PATH_MAX} and {NAME_MAX}. If <i>name</i> begins with the &lt;slash&gt; character, then processes calling
<i>shm_open</i>() with the same value of <i>name</i> refer to the same shared memory object, as long as that name has not been
removed. If <i>name</i> does not begin with the &lt;slash&gt; character, the effect is implementation-defined.</p>

<p>If successful, <i>shm_open</i>() shall return a file descriptor for the shared memory object. The open file description is new,
and therefore the file descriptor does not share it with any other processes. It is unspecified whether the file offset is set. The
FD_CLOEXEC file descriptor flag associated with the new file descriptor is set.</p>

<p>The file status flags and file access modes of the open file description are according to the value of <i>oflag</i>. The
<i>oflag</i> argument is the bitwise-inclusive OR of the following flags defined in the <a href=
"../basedefs/fcntl.h.html"><i>&lt;fcntl.h&gt;</i></a> header. Applications specify exactly one of the first two values (access
modes) below in the value of <i>oflag</i>:</p>

<dl compact>
<dt>O_RDONLY</dt>

<dd>Open for read access only.</dd>

<dt>O_RDWR</dt>

<dd>Open for read or write access.</dd>
</dl>

<p>Any combination of the remaining flags may be specified in the value of <i>oflag</i>:</p>

<dl compact>
<dt>O_CREAT</dt>

<dd>If the shared memory object exists, this flag has no effect, except as noted under O_EXCL below. Otherwise, the shared memory
object is created. The user ID of the shared memory object shall be set to the effective user ID of the process. The group ID of
the shared memory object shall be set to the effective group ID of the process; however, if the <i>name</i> argument is visible in
the file system, the group ID may be set to the group ID of the containing directory. The permission bits of the shared memory
object shall be set to the value of the <i>mode</i> argument except those set in the file mode creation mask of the process. When
bits in <i>mode</i> other than the file permission bits are set, the effect is unspecified. The <i>mode</i> argument does not
affect whether the shared memory object is opened for reading, for writing, or for both. The shared memory object has a size of
zero.</dd>

<dt>O_EXCL</dt>

<dd>If O_EXCL and O_CREAT are set, <i>shm_open</i>() fails if the shared memory object exists. The check for the existence of the
shared memory object and the creation of the object if it does not exist is atomic with respect to other processes executing
<i>shm_open</i>() naming the same shared memory object with O_EXCL and O_CREAT set. If O_EXCL is set and O_CREAT is not set, the
result is undefined.</dd>

<dt>O_TRUNC</dt>

<dd>If the shared memory object exists, and it is successfully opened O_RDWR, the object shall be truncated to zero length and the
mode and owner shall be unchanged by this function call. The result of using O_TRUNC with O_RDONLY is undefined.</dd>
</dl>

<p>When a shared memory object is created, the state of the shared memory object, including all data associated with the shared
memory object, persists until the shared memory object is unlinked and all other references are gone. It is unspecified whether the
name and shared memory object state remain valid after a system reboot.</p>
</blockquote>

<h4 class="mansect"><a name="tag_16_533_04"></a>RETURN VALUE</h4>

<blockquote>
<p>Upon successful completion, the <i>shm_open</i>() function shall return a non-negative integer representing the file descriptor.
Otherwise, it shall return -1 and set <i>errno</i> to indicate the error.</p>
</blockquote>

<h4 class="mansect"><a name="tag_16_533_05"></a>ERRORS</h4>

<blockquote>
<p>The <i>shm_open</i>() function shall fail if:</p>

<dl compact>
<dt>[EACCES]</dt>

<dd>The shared memory object exists and the permissions specified by <i>oflag</i> are denied, or the shared memory object does not
exist and permission to create the shared memory object is denied, or O_TRUNC is specified and write permission is denied.</dd>

<dt>[EEXIST]</dt>

<dd>O_CREAT and O_EXCL are set and the named shared memory object already exists.</dd>

<dt>[EINTR]</dt>

<dd>The <i>shm_open</i>() operation was interrupted by a signal.</dd>

<dt>[EINVAL]</dt>

<dd>The <i>shm_open</i>() operation is not supported for the given name.</dd>

<dt>[EMFILE]</dt>

<dd>All file descriptors available to the process are currently open.</dd>

<dt>[ENFILE]</dt>

<dd>Too many shared memory objects are currently open in the system.</dd>

<dt>[ENOENT]</dt>

<dd>O_CREAT is not set and the named shared memory object does not exist.</dd>

<dt>[ENOSPC]</dt>

<dd>There is insufficient space for the creation of the new shared memory object.</dd>
</dl>

<p>The <i>shm_open</i>() function may fail if:</p>

<dl compact>
<dt>[ENAMETOOLONG]</dt>

<dd>
The length of the <i>name</i> argument exceeds {_POSIX_PATH_MAX} on systems that do not support the XSI option <sup>[<a href=
"javascript:open_code('XSI')">XSI</a>]</sup> <img src="../images/opt-start.gif" alt="[Option Start]" border="0"> &nbsp;or exceeds
{_XOPEN_PATH_MAX} on XSI systems, <img src="../images/opt-end.gif" alt="[Option End]" border="0"> &nbsp;or has a pathname component
that is longer than {_POSIX_NAME_MAX} on systems that do not support the XSI option <sup>[<a href=
"javascript:open_code('XSI')">XSI</a>]</sup> <img src="../images/opt-start.gif" alt="[Option Start]" border="0"> &nbsp;or longer
than {_XOPEN_NAME_MAX} on XSI systems. <img src="../images/opt-end.gif" alt="[Option End]" border="0"></dd>
</dl>
</blockquote>

<hr>
<div class="box"><em>The following sections are informative.</em></div>

<h4 class="mansect"><a name="tag_16_533_06"></a>EXAMPLES</h4>

<blockquote>
<h5><a name="tag_16_533_06_01"></a>Creating and Mapping a Shared Memory Object</h5>

<p>The following code segment demonstrates the use of <i>shm_open</i>() to create a shared memory object which is then sized using
<a href="../functions/ftruncate.html"><i>ftruncate</i>()</a> before being mapped into the process address space using <a href=
"../functions/mmap.html"><i>mmap</i>()</a>:</p>

<pre>
<tt>#include &lt;unistd.h&gt;
#include &lt;sys/mman.h&gt;
...
<br>
#define MAX_LEN 10000
struct region {        /* Defines "structure" of shared memory */
    int len;
    char buf[MAX_LEN];
};
struct region *rptr;
int fd;
<br>
/* Create shared memory object and set its size */
<br>
fd = shm_open("/myregion", O_CREAT | O_RDWR, S_IRUSR | S_IWUSR);
if (fd == -1)
    /* Handle error */;
<br>
if (ftruncate(fd, sizeof(struct region)) == -1)
    /* Handle error */;
<br>
/* Map shared memory object */
<br>
rptr = mmap(NULL, sizeof(struct region),
       PROT_READ | PROT_WRITE, MAP_SHARED, fd, 0);
if (rptr == MAP_FAILED)
    /* Handle error */;
<br>
/* Now we can refer to mapped region using fields of rptr;
   for example, rptr-&gt;len */
...
</tt>
</pre>
</blockquote>

<h4 class="mansect"><a name="tag_16_533_07"></a>APPLICATION USAGE</h4>

<blockquote>
<p>None.</p>
</blockquote>

<h4 class="mansect"><a name="tag_16_533_08"></a>RATIONALE</h4>

<blockquote>
<p>When the Memory Mapped Files option is supported, the normal <a href="../functions/open.html"><i>open</i>()</a> call is used to
obtain a descriptor to a file to be mapped according to existing practice with <a href="../functions/mmap.html"><i>mmap</i>()</a>.
When the Shared Memory Objects option is supported, the <i>shm_open</i>() function shall obtain a descriptor to the shared memory
object to be mapped.</p>

<p>There is ample precedent for having a file descriptor represent several types of objects. In the POSIX.1-1990 standard, a file
descriptor can represent a file, a pipe, a FIFO, a tty, or a directory. Many implementations simply have an operations vector,
which is indexed by the file descriptor type and does very different operations. Note that in some cases the file descriptor passed
to generic operations on file descriptors is returned by <a href="../functions/open.html"><i>open</i>()</a> or <a href=
"../functions/creat.html"><i>creat</i>()</a> and in some cases returned by alternate functions, such as <a href=
"../functions/pipe.html"><i>pipe</i>()</a>. The latter technique is used by <i>shm_open</i>().</p>

<p>Note that such shared memory objects can actually be implemented as mapped files. In both cases, the size can be set after the
open using <a href="../functions/ftruncate.html"><i>ftruncate</i>()</a>. The <i>shm_open</i>() function itself does not create a
shared object of a specified size because this would duplicate an extant function that set the size of an object referenced by a
file descriptor.</p>

<p>On implementations where memory objects are implemented using the existing file system, the <i>shm_open</i>() function may be
implemented using a macro that invokes <a href="../functions/open.html"><i>open</i>()</a>, and the <a href=
"../functions/shm_unlink.html"><i>shm_unlink</i>()</a> function may be implemented using a macro that invokes <a href=
"../functions/unlink.html"><i>unlink</i>()</a>.</p>

<p>For implementations without a permanent file system, the definition of the name of the memory objects is allowed not to survive
a system reboot. Note that this allows systems with a permanent file system to implement memory objects as data structures internal
to the implementation as well.</p>

<p>On implementations that choose to implement memory objects using memory directly, a <i>shm_open</i>() followed by an <a href=
"../functions/ftruncate.html"><i>ftruncate</i>()</a> and <a href="../functions/close.html"><i>close</i>()</a> can be used to
preallocate a shared memory area and to set the size of that preallocation. This may be necessary for systems without virtual
memory hardware support in order to ensure that the memory is contiguous.</p>

<p>The set of valid open flags to <i>shm_open</i>() was restricted to O_RDONLY, O_RDWR, O_CREAT, and O_TRUNC because these could be
easily implemented on most memory mapping systems. This volume of POSIX.1-2017 is silent on the results if the implementation
cannot supply the requested file access because of implementation-defined reasons, including hardware ones.</p>

<p>The error conditions [EACCES] and [ENOTSUP] are provided to inform the application that the implementation cannot complete a
request.</p>

<p>[EACCES] indicates for implementation-defined reasons, probably hardware-related, that the implementation cannot comply with a
requested mode because it conflicts with another requested mode. An example might be that an application desires to open a memory
object two times, mapping different areas with different access modes. If the implementation cannot map a single area into a
process space in two places, which would be required if different access modes were required for the two areas, then the
implementation may inform the application at the time of the second open.</p>

<p>[ENOTSUP] indicates for implementation-defined reasons, probably hardware-related, that the implementation cannot comply with a
requested mode at all. An example would be that the hardware of the implementation cannot support write-only shared memory
areas.</p>

<p>On all implementations, it may be desirable to restrict the location of the memory objects to specific file systems for
performance (such as a RAM disk) or implementation-defined reasons (shared memory supported directly only on certain file systems).
The <i>shm_open</i>() function may be used to enforce these restrictions. There are a number of methods available to the
application to determine an appropriate name of the file or the location of an appropriate directory. One way is from the
environment via <a href="../functions/getenv.html"><i>getenv</i>()</a>. Another would be from a configuration file.</p>

<p>This volume of POSIX.1-2017 specifies that memory objects have initial contents of zero when created. This is consistent with
current behavior for both files and newly allocated memory. For those implementations that use physical memory, it would be
possible that such implementations could simply use available memory and give it to the process uninitialized. This, however, is
not consistent with standard behavior for the uninitialized data area, the stack, and of course, files. Finally, it is highly
desirable to set the allocated memory to zero for security reasons. Thus, initializing memory objects to zero is required.</p>
</blockquote>

<h4 class="mansect"><a name="tag_16_533_09"></a>FUTURE DIRECTIONS</h4>

<blockquote>
<p>A future version might require the <i>shm_open</i>() and <a href="../functions/shm_unlink.html"><i>shm_unlink</i>()</a>
functions to have semantics similar to normal file system operations.</p>
</blockquote>

<h4 class="mansect"><a name="tag_16_533_10"></a>SEE ALSO</h4>

<blockquote>
<p><a href="../functions/V2_chap02.html#tag_15_14"><i>File Descriptor Allocation</i></a>, <a href=
"../functions/close.html#"><i>close</i></a>, <a href="../functions/dup.html#"><i>dup</i></a>, <a href=
"../functions/exec.html#tag_16_111"><i><a href="../functions/exec.html">exec</a></i></a>, <a href=
"../functions/fcntl.html#"><i>fcntl</i></a>, <a href="../functions/mmap.html#"><i>mmap</i></a>, <a href=
"../functions/shmat.html#"><i>shmat</i></a>, <a href="../functions/shmctl.html#"><i>shmctl</i></a>, <a href=
"../functions/shmdt.html#"><i>shmdt</i></a>, <a href="../functions/shm_unlink.html#"><i>shm_unlink</i></a>, <a href=
"../functions/umask.html#tag_16_631"><i>umask</i></a></p>

<p>XBD <a href="../basedefs/fcntl.h.html"><i>&lt;fcntl.h&gt;</i></a>, <a href=
"../basedefs/sys_mman.h.html"><i>&lt;sys/mman.h&gt;</i></a></p>
</blockquote>

<h4 class="mansect"><a name="tag_16_533_11"></a>CHANGE HISTORY</h4>

<blockquote>
<p>First released in Issue 5. Included for alignment with the POSIX Realtime Extension.</p>
</blockquote>

<h4 class="mansect"><a name="tag_16_533_12"></a>Issue 6</h4>

<blockquote>
<p>The <i>shm_open</i>() function is marked as part of the Shared Memory Objects option.</p>

<p>The [ENOSYS] error condition has been removed as stubs need not be provided if an implementation does not support the Shared
Memory Objects option.</p>

<p>IEEE&nbsp;Std&nbsp;1003.1-2001/Cor&nbsp;2-2004, item XSH/TC2/D6/126 is applied, adding the example to the EXAMPLES section.</p>
</blockquote>

<h4 class="mansect"><a name="tag_16_533_13"></a>Issue 7</h4>

<blockquote>
<p>Austin Group Interpretation 1003.1-2001 #077 is applied, clarifying the <i>name</i> argument and changing [ENAMETOOLONG] from a
``shall fail'' to a ``may fail'' error.</p>

<p>Austin Group Interpretation 1003.1-2001 #141 is applied, adding FUTURE DIRECTIONS.</p>

<p>SD5-XSH-ERN-170 is applied, updating the DESCRIPTION to clarify the wording for setting the user ID and group ID of the shared
memory object.</p>

<p>POSIX.1-2008, Technical Corrigendum 2, XSH/TC2-2008/0324 [835], XSH/TC2-2008/0325 [835], and XSH/TC2-2008/0326 [835] are
applied.</p>
</blockquote>

<div class="box"><em>End of informative text.</em></div>

<hr>
<p>&nbsp;</p>

<a href="#top"><span class="topOfPage">return to top of page</span></a><br>
<hr size="2" noshade>
<center><font size="2">UNIX &reg; is a registered Trademark of The Open Group.<br>
POSIX &reg; is a registered Trademark of The IEEE.<br>
Copyright &copy; 2001-2018 IEEE and The Open Group, All Rights Reserved<br>
[ <a href="../mindex.html">Main Index</a> | <a href="../basedefs/contents.html">XBD</a> | <a href=
"../functions/contents.html">XSH</a> | <a href="../utilities/contents.html">XCU</a> | <a href="../xrat/contents.html">XRAT</a>
]</font></center>

<hr size="2" noshade>
<div class="NAVHEADER">
<table summary="Header navigation table" class="nav" width="100%" border="0" cellpadding="0" cellspacing="0">
<tr class="nav">
<td class="nav" width="15%" align="left" valign="bottom"><a href="../functions/setvbuf.html" accesskey="P">&lt;&lt;&lt;
Previous</a></td>
<td class="nav" width="70%" align="center" valign="bottom"><a href="contents.html">Home</a></td>
<td class="nav" width="15%" align="right" valign="bottom"><a href="../functions/shm_unlink.html" accesskey="N">Next
&gt;&gt;&gt;</a></td>
</tr>
</table>

<hr align="LEFT" width="100%">
</div>
</body>
</html>

