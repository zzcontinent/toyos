<!-- Copyright 2001-2013 IEEE and The Open Group, All Rights Reserved -->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="HTML Tidy, see www.w3.org">
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link type="text/css" rel="stylesheet" href="style.css"><!-- Generated by The Open Group's rhtm tool v1.2.4 -->
<!-- Copyright (c) 2001-2013 The Open Group, All Rights Reserved -->
<title>pthread_setcancelstate</title>
</head>
<body bgcolor="white">
<div class="NAVHEADER">
<table summary="Header navigation table" class="nav" width="100%" border="0" cellpadding="0" cellspacing="0">
<tr class="nav">
<td class="nav" width="15%" align="left" valign="bottom"><a href="../functions/pthread_self.html" accesskey="P">&lt;&lt;&lt;
Previous</a></td>
<td class="nav" width="70%" align="center" valign="bottom"><a href="contents.html">Home</a></td>
<td class="nav" width="15%" align="right" valign="bottom"><a href="../functions/pthread_setschedprio.html" accesskey="N">Next
&gt;&gt;&gt;</a></td>
</tr>
</table>

<hr align="LEFT" width="100%">
</div>


<basefont size="3"> 

<center><font size="2">The Open Group Base Specifications Issue 7, 2018 edition<br>
IEEE Std 1003.1-2017 (Revision of IEEE Std 1003.1-2008)<br>
Copyright &copy; 2001-2018 IEEE and The Open Group</font></center>

<hr size="2" noshade>
<a name="top"></a> <a name="pthread_setcancelstate"></a> <a name="tag_16_457"></a><!-- pthread_setcancelstate -->
 

<h4 class="mansect"><a name="tag_16_457_01"></a>NAME</h4>

<blockquote>pthread_setcancelstate, pthread_setcanceltype, pthread_testcancel - set cancelability state</blockquote>

<h4 class="mansect"><a name="tag_16_457_02"></a>SYNOPSIS</h4>

<blockquote class="synopsis">
<p><code><tt>#include &lt;<a href="../basedefs/pthread.h.html">pthread.h</a>&gt;<br>
<br>
 int pthread_setcancelstate(int</tt> <i>state</i><tt>, int *</tt><i>oldstate</i><tt>);<br>
 int pthread_setcanceltype(int</tt> <i>type</i><tt>, int *</tt><i>oldtype</i><tt>);<br>
 void pthread_testcancel(void);<br>
</tt></code></p>
</blockquote>

<h4 class="mansect"><a name="tag_16_457_03"></a>DESCRIPTION</h4>

<blockquote>
<p>The <i>pthread_setcancelstate</i>() function shall atomically both set the calling thread's cancelability state to the indicated
<i>state</i> and return the previous cancelability state at the location referenced by <i>oldstate</i>. Legal values for
<i>state</i> are PTHREAD_CANCEL_ENABLE and PTHREAD_CANCEL_DISABLE.</p>

<p>The <i>pthread_setcanceltype</i>() function shall atomically both set the calling thread's cancelability type to the indicated
<i>type</i> and return the previous cancelability type at the location referenced by <i>oldtype</i>. Legal values for <i>type</i>
are PTHREAD_CANCEL_DEFERRED and PTHREAD_CANCEL_ASYNCHRONOUS.</p>

<p>The cancelability state and type of any newly created threads, including the thread in which <i>main</i>() was first invoked,
shall be PTHREAD_CANCEL_ENABLE and PTHREAD_CANCEL_DEFERRED respectively.</p>

<p>The <i>pthread_testcancel</i>() function shall create a cancellation point in the calling thread. The
<i>pthread_testcancel</i>() function shall have no effect if cancelability is disabled.</p>
</blockquote>

<h4 class="mansect"><a name="tag_16_457_04"></a>RETURN VALUE</h4>

<blockquote>
<p>If successful, the <i>pthread_setcancelstate</i>() and <i>pthread_setcanceltype</i>() functions shall return zero; otherwise, an
error number shall be returned to indicate the error.</p>
</blockquote>

<h4 class="mansect"><a name="tag_16_457_05"></a>ERRORS</h4>

<blockquote>
<p>The <i>pthread_setcancelstate</i>() function may fail if:</p>

<dl compact>
<dt>[EINVAL]</dt>

<dd>The specified state is not PTHREAD_CANCEL_ENABLE or PTHREAD_CANCEL_DISABLE.</dd>
</dl>

<p>The <i>pthread_setcanceltype</i>() function may fail if:</p>

<dl compact>
<dt>[EINVAL]</dt>

<dd>The specified type is not PTHREAD_CANCEL_DEFERRED or PTHREAD_CANCEL_ASYNCHRONOUS.</dd>
</dl>

<p>These functions shall not return an error code of [EINTR].</p>
</blockquote>

<hr>
<div class="box"><em>The following sections are informative.</em></div>

<h4 class="mansect"><a name="tag_16_457_06"></a>EXAMPLES</h4>

<blockquote>
<p>None.</p>
</blockquote>

<h4 class="mansect"><a name="tag_16_457_07"></a>APPLICATION USAGE</h4>

<blockquote>
<p>In order to write a signal handler for an asynchronous signal which can run safely in a cancellable thread,
<i>pthread_setcancelstate</i>() must be used to disable cancellation for the duration of any calls that the signal handler makes
which are cancellation points. However, the standard does not permit strictly conforming applications to call
<i>pthread_setcancelstate</i>() from a signal handler since it is not currently required to be async-signal-safe. On
implementations where <i>pthread_setcancelstate</i>() is not async-signal-safe, alternatives are to ensure either that the
corresponding signals are blocked during execution of functions that are not async-cancel-safe or that cancellation is disabled
during times when those signals could be delivered. Implementations are strongly encouraged to make <i>pthread_setcancelstate</i>()
async-signal-safe.</p>
</blockquote>

<h4 class="mansect"><a name="tag_16_457_08"></a>RATIONALE</h4>

<blockquote>
<p>The <i>pthread_setcancelstate</i>() and <i>pthread_setcanceltype</i>() functions control the points at which a thread may be
asynchronously canceled. For cancellation control to be usable in modular fashion, some rules need to be followed.</p>

<p>An object can be considered to be a generalization of a procedure. It is a set of procedures and global variables written as a
unit and called by clients not known by the object. Objects may depend on other objects.</p>

<p>First, cancelability should only be disabled on entry to an object, never explicitly enabled. On exit from an object, the
cancelability state should always be restored to its value on entry to the object.</p>

<p>This follows from a modularity argument: if the client of an object (or the client of an object that uses that object) has
disabled cancelability, it is because the client does not want to be concerned about cleaning up if the thread is canceled while
executing some sequence of actions. If an object is called in such a state and it enables cancelability and a cancellation request
is pending for that thread, then the thread is canceled, contrary to the wish of the client that disabled.</p>

<p>Second, the cancelability type may be explicitly set to either <i>deferred</i> or <i>asynchronous</i> upon entry to an object.
But as with the cancelability state, on exit from an object the cancelability type should always be restored to its value on entry
to the object.</p>

<p>Finally, only functions that are cancel-safe may be called from a thread that is asynchronously cancelable.</p>
</blockquote>

<h4 class="mansect"><a name="tag_16_457_09"></a>FUTURE DIRECTIONS</h4>

<blockquote>
<p>The <i>pthread_setcancelstate</i>() function may be added to the table of async-signal-safe functions in <a href=
"../functions/V2_chap02.html#tag_15_04_03"><i>Signal Actions</i></a>.</p>
</blockquote>

<h4 class="mansect"><a name="tag_16_457_10"></a>SEE ALSO</h4>

<blockquote>
<p><a href="../functions/pthread_cancel.html#"><i>pthread_cancel</i></a></p>

<p>XBD <a href="../basedefs/pthread.h.html"><i>&lt;pthread.h&gt;</i></a></p>
</blockquote>

<h4 class="mansect"><a name="tag_16_457_11"></a>CHANGE HISTORY</h4>

<blockquote>
<p>First released in Issue 5. Included for alignment with the POSIX Threads Extension.</p>
</blockquote>

<h4 class="mansect"><a name="tag_16_457_12"></a>Issue 6</h4>

<blockquote>
<p>The <i>pthread_setcancelstate</i>(), <i>pthread_setcanceltype</i>(), and <i>pthread_testcancel</i>() functions are marked as
part of the Threads option.</p>
</blockquote>

<h4 class="mansect"><a name="tag_16_457_13"></a>Issue 7</h4>

<blockquote>
<p>The <i>pthread_setcancelstate</i>(), <i>pthread_setcanceltype</i>(), and <i>pthread_testcancel</i>() functions are moved from
the Threads option to the Base.</p>

<p>POSIX.1-2008, Technical Corrigendum 2, XSH/TC2-2008/0294 [622] and XSH/TC2-2008/0295 [615] are applied.</p>
</blockquote>

<div class="box"><em>End of informative text.</em></div>

<hr>
<p>&nbsp;</p>

<a href="#top"><span class="topOfPage">return to top of page</span></a><br>
<hr size="2" noshade>
<center><font size="2">UNIX &reg; is a registered Trademark of The Open Group.<br>
POSIX &reg; is a registered Trademark of The IEEE.<br>
Copyright &copy; 2001-2018 IEEE and The Open Group, All Rights Reserved<br>
[ <a href="../mindex.html">Main Index</a> | <a href="../basedefs/contents.html">XBD</a> | <a href=
"../functions/contents.html">XSH</a> | <a href="../utilities/contents.html">XCU</a> | <a href="../xrat/contents.html">XRAT</a>
]</font></center>

<hr size="2" noshade>
<div class="NAVHEADER">
<table summary="Header navigation table" class="nav" width="100%" border="0" cellpadding="0" cellspacing="0">
<tr class="nav">
<td class="nav" width="15%" align="left" valign="bottom"><a href="../functions/pthread_self.html" accesskey="P">&lt;&lt;&lt;
Previous</a></td>
<td class="nav" width="70%" align="center" valign="bottom"><a href="contents.html">Home</a></td>
<td class="nav" width="15%" align="right" valign="bottom"><a href="../functions/pthread_setschedprio.html" accesskey="N">Next
&gt;&gt;&gt;</a></td>
</tr>
</table>

<hr align="LEFT" width="100%">
</div>
</body>
</html>

