<!-- Copyright 2001-2013 IEEE and The Open Group, All Rights Reserved -->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="HTML Tidy, see www.w3.org">
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link type="text/css" rel="stylesheet" href="style.css"><!-- Generated by The Open Group's rhtm tool v1.2.4 -->
<!-- Copyright (c) 2001-2013 The Open Group, All Rights Reserved -->
<title>pthread_key_delete</title>
</head>
<body bgcolor="white">
<div class="NAVHEADER">
<table summary="Header navigation table" class="nav" width="100%" border="0" cellpadding="0" cellspacing="0">
<tr class="nav">
<td class="nav" width="15%" align="left" valign="bottom"><a href="../functions/pthread_key_create.html" accesskey="P">&lt;&lt;&lt;
Previous</a></td>
<td class="nav" width="70%" align="center" valign="bottom"><a href="contents.html">Home</a></td>
<td class="nav" width="15%" align="right" valign="bottom"><a href="../functions/pthread_kill.html" accesskey="N">Next
&gt;&gt;&gt;</a></td>
</tr>
</table>

<hr align="LEFT" width="100%">
</div>


<basefont size="3"> 

<center><font size="2">The Open Group Base Specifications Issue 7, 2018 edition<br>
IEEE Std 1003.1-2017 (Revision of IEEE Std 1003.1-2008)<br>
Copyright &copy; 2001-2018 IEEE and The Open Group</font></center>

<hr size="2" noshade>
<a name="top"></a> <a name="pthread_key_delete"></a> <a name="tag_16_434"></a><!-- pthread_key_delete -->
 

<h4 class="mansect"><a name="tag_16_434_01"></a>NAME</h4>

<blockquote>pthread_key_delete - thread-specific data key deletion</blockquote>

<h4 class="mansect"><a name="tag_16_434_02"></a>SYNOPSIS</h4>

<blockquote class="synopsis">
<p><code><tt>#include &lt;<a href="../basedefs/pthread.h.html">pthread.h</a>&gt;<br>
<br>
 int pthread_key_delete(pthread_key_t</tt> <i>key</i><tt>);<br>
</tt></code></p>
</blockquote>

<h4 class="mansect"><a name="tag_16_434_03"></a>DESCRIPTION</h4>

<blockquote>
<p>The <i>pthread_key_delete</i>() function shall delete a thread-specific data key previously returned by <a href=
"../functions/pthread_key_create.html"><i>pthread_key_create</i>()</a>. The thread-specific data values associated with <i>key</i>
need not be NULL at the time <i>pthread_key_delete</i>() is called. It is the responsibility of the application to free any
application storage or perform any cleanup actions for data structures related to the deleted key or associated thread-specific
data in any threads; this cleanup can be done either before or after <i>pthread_key_delete</i>() is called. Any attempt to use
<i>key</i> following the call to <i>pthread_key_delete</i>() results in undefined behavior.</p>

<p>The <i>pthread_key_delete</i>() function shall be callable from within destructor functions. No destructor functions shall be
invoked by <i>pthread_key_delete</i>(). Any destructor function that may have been associated with <i>key</i> shall no longer be
called upon thread exit.</p>
</blockquote>

<h4 class="mansect"><a name="tag_16_434_04"></a>RETURN VALUE</h4>

<blockquote>
<p>If successful, the <i>pthread_key_delete</i>() function shall return zero; otherwise, an error number shall be returned to
indicate the error.</p>
</blockquote>

<h4 class="mansect"><a name="tag_16_434_05"></a>ERRORS</h4>

<blockquote>
<p>The <i>pthread_key_delete</i>() function shall not return an error code of [EINTR].</p>
</blockquote>

<hr>
<div class="box"><em>The following sections are informative.</em></div>

<h4 class="mansect"><a name="tag_16_434_06"></a>EXAMPLES</h4>

<blockquote>
<p>None.</p>
</blockquote>

<h4 class="mansect"><a name="tag_16_434_07"></a>APPLICATION USAGE</h4>

<blockquote>
<p>None.</p>
</blockquote>

<h4 class="mansect"><a name="tag_16_434_08"></a>RATIONALE</h4>

<blockquote>
<p>A thread-specific data key deletion function has been included in order to allow the resources associated with an unused
thread-specific data key to be freed. Unused thread-specific data keys can arise, among other scenarios, when a dynamically loaded
module that allocated a key is unloaded.</p>

<p>Conforming applications are responsible for performing any cleanup actions needed for data structures associated with the key to
be deleted, including data referenced by thread-specific data values. No such cleanup is done by <i>pthread_key_delete</i>(). In
particular, destructor functions are not called. There are several reasons for this division of responsibility:</p>

<ol>
<li>
<p>The associated destructor functions used to free thread-specific data at thread exit time are only guaranteed to work correctly
when called in the thread that allocated the thread-specific data. (Destructors themselves may utilize thread-specific data.) Thus,
they cannot be used to free thread-specific data in other threads at key deletion time. Attempting to have them called by other
threads at key deletion time would require other threads to be asynchronously interrupted. But since interrupted threads could be
in an arbitrary state, including holding locks necessary for the destructor to run, this approach would fail. In general, there is
no safe mechanism whereby an implementation could free thread-specific data at key deletion time.</p>
</li>

<li>
<p>Even if there were a means of safely freeing thread-specific data associated with keys to be deleted, doing so would require
that implementations be able to enumerate the threads with non-NULL data and potentially keep them from creating more
thread-specific data while the key deletion is occurring. This special case could cause extra synchronization in the normal case,
which would otherwise be unnecessary.</p>
</li>
</ol>

<p>For an application to know that it is safe to delete a key, it has to know that all the threads that might potentially ever use
the key do not attempt to use it again. For example, it could know this if all the client threads have called a cleanup procedure
declaring that they are through with the module that is being shut down, perhaps by setting a reference count to zero.</p>

<p>If an implementation detects that the value specified by the <i>key</i> argument to <i>pthread_key_delete</i>() does not refer
to a a key value obtained from <a href="../functions/pthread_key_create.html"><i>pthread_key_create</i>()</a> or refers to a key
that has been deleted with <i>pthread_key_delete</i>(), it is recommended that the function should fail and report an [EINVAL]
error.</p>
</blockquote>

<h4 class="mansect"><a name="tag_16_434_09"></a>FUTURE DIRECTIONS</h4>

<blockquote>
<p>None.</p>
</blockquote>

<h4 class="mansect"><a name="tag_16_434_10"></a>SEE ALSO</h4>

<blockquote>
<p><a href="../functions/pthread_key_create.html#"><i>pthread_key_create</i></a></p>

<p>XBD <a href="../basedefs/pthread.h.html"><i>&lt;pthread.h&gt;</i></a></p>
</blockquote>

<h4 class="mansect"><a name="tag_16_434_11"></a>CHANGE HISTORY</h4>

<blockquote>
<p>First released in Issue 5. Included for alignment with the POSIX Threads Extension.</p>
</blockquote>

<h4 class="mansect"><a name="tag_16_434_12"></a>Issue 6</h4>

<blockquote>
<p>The <i>pthread_key_delete</i>() function is marked as part of the Threads option.</p>
</blockquote>

<h4 class="mansect"><a name="tag_16_434_13"></a>Issue 7</h4>

<blockquote>
<p>The <i>pthread_key_delete</i>() function is moved from the Threads option to the Base.</p>

<p>The [EINVAL] error for a key value not obtained from <a href=
"../functions/pthread_key_create.html"><i>pthread_key_create</i>()</a> or a key deleted with <i>pthread_key_delete</i>() is
removed; this condition results in undefined behavior.</p>
</blockquote>

<div class="box"><em>End of informative text.</em></div>

<hr>
<p>&nbsp;</p>

<a href="#top"><span class="topOfPage">return to top of page</span></a><br>
<hr size="2" noshade>
<center><font size="2">UNIX &reg; is a registered Trademark of The Open Group.<br>
POSIX &reg; is a registered Trademark of The IEEE.<br>
Copyright &copy; 2001-2018 IEEE and The Open Group, All Rights Reserved<br>
[ <a href="../mindex.html">Main Index</a> | <a href="../basedefs/contents.html">XBD</a> | <a href=
"../functions/contents.html">XSH</a> | <a href="../utilities/contents.html">XCU</a> | <a href="../xrat/contents.html">XRAT</a>
]</font></center>

<hr size="2" noshade>
<div class="NAVHEADER">
<table summary="Header navigation table" class="nav" width="100%" border="0" cellpadding="0" cellspacing="0">
<tr class="nav">
<td class="nav" width="15%" align="left" valign="bottom"><a href="../functions/pthread_key_create.html" accesskey="P">&lt;&lt;&lt;
Previous</a></td>
<td class="nav" width="70%" align="center" valign="bottom"><a href="contents.html">Home</a></td>
<td class="nav" width="15%" align="right" valign="bottom"><a href="../functions/pthread_kill.html" accesskey="N">Next
&gt;&gt;&gt;</a></td>
</tr>
</table>

<hr align="LEFT" width="100%">
</div>
</body>
</html>

