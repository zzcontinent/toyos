<!-- Copyright 2001-2013 IEEE and The Open Group, All Rights Reserved -->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="HTML Tidy, see www.w3.org">
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link type="text/css" rel="stylesheet" href="style.css"><!-- Generated by The Open Group's rhtm tool v1.2.4 -->
<!-- Copyright (c) 2001-2013 The Open Group, All Rights Reserved -->
<title>open</title>
</head>
<body bgcolor="white">
<div class="NAVHEADER">
<table summary="Header navigation table" class="nav" width="100%" border="0" cellpadding="0" cellspacing="0">
<tr class="nav">
<td class="nav" width="15%" align="left" valign="bottom"><a href="../functions/nl_langinfo.html" accesskey="P">&lt;&lt;&lt;
Previous</a></td>
<td class="nav" width="70%" align="center" valign="bottom"><a href="contents.html">Home</a></td>
<td class="nav" width="15%" align="right" valign="bottom"><a href="../functions/open_memstream.html" accesskey="N">Next
&gt;&gt;&gt;</a></td>
</tr>
</table>

<hr align="LEFT" width="100%">
</div>

<script type="text/javascript" language="JavaScript" src="../jscript/codes.js">
</script>

<basefont size="3"> 

<center><font size="2">The Open Group Base Specifications Issue 7, 2018 edition<br>
IEEE Std 1003.1-2017 (Revision of IEEE Std 1003.1-2008)<br>
Copyright &copy; 2001-2018 IEEE and The Open Group</font></center>

<hr size="2" noshade>
<a name="top"></a> <a name="open"></a> <a name="tag_16_357"></a><!-- open -->
 

<h4 class="mansect"><a name="tag_16_357_01"></a>NAME</h4>

<blockquote>open, openat - open file</blockquote>

<h4 class="mansect"><a name="tag_16_357_02"></a>SYNOPSIS</h4>

<blockquote class="synopsis">
<p><code><tt><sup>[<a href="javascript:open_code('OH')">OH</a>]</sup> <img src="../images/opt-start.gif" border="0">#include
&lt;sys/stat.h&gt;<img src="../images/opt-end.gif" border="0"> #include &lt;<a href="../basedefs/fcntl.h.html">fcntl.h</a>&gt;<br>
<br>
 int open(const char *</tt><i>path</i><tt>, int</tt> <i>oflag</i><tt>, ...);<br>
 int openat(int</tt> <i>fd</i><tt>, const char *</tt><i>path</i><tt>, int</tt> <i>oflag</i><tt>, ...);<br>
</tt></code></p>
</blockquote>

<h4 class="mansect"><a name="tag_16_357_03"></a>DESCRIPTION</h4>

<blockquote>
<p>The <i>open</i>() function shall establish the connection between a file and a file descriptor. It shall create an open file
description that refers to a file and a file descriptor that refers to that open file description. The file descriptor is used by
other I/O functions to refer to that file. The <i>path</i> argument points to a pathname naming the file.</p>

<p>The <i>open</i>() function shall return a file descriptor for the named file, allocated as described in <a href=
"../functions/V2_chap02.html#tag_15_14"><i>File Descriptor Allocation</i></a>. The open file description is new, and therefore the
file descriptor shall not share it with any other process in the system. The FD_CLOEXEC file descriptor flag associated with the
new file descriptor shall be cleared unless the O_CLOEXEC flag is set in <i>oflag</i>.</p>

<p>The file offset used to mark the current position within the file shall be set to the beginning of the file.</p>

<p>The file status flags and file access modes of the open file description shall be set according to the value of
<i>oflag</i>.</p>

<p>Values for <i>oflag</i> are constructed by a bitwise-inclusive OR of flags from the following list, defined in <a href=
"../basedefs/fcntl.h.html"><i>&lt;fcntl.h&gt;</i></a>. Applications shall specify exactly one of the first five values (file access
modes) below in the value of <i>oflag</i>:</p>

<dl compact>
<dt>O_EXEC</dt>

<dd>Open for execute only (non-directory files). The result is unspecified if this flag is applied to a directory.</dd>

<dt>O_RDONLY</dt>

<dd>Open for reading only.</dd>

<dt>O_RDWR</dt>

<dd>Open for reading and writing. The result is undefined if this flag is applied to a FIFO.</dd>

<dt>O_SEARCH</dt>

<dd>Open directory for search only. The result is unspecified if this flag is applied to a non-directory file.</dd>

<dt>O_WRONLY</dt>

<dd>Open for writing only.</dd>
</dl>

<p>Any combination of the following may be used:</p>

<dl compact>
<dt>O_APPEND</dt>

<dd>If set, the file offset shall be set to the end of the file prior to each write.</dd>

<dt>O_CLOEXEC</dt>

<dd>If set, the FD_CLOEXEC flag for the new file descriptor shall be set.</dd>

<dt>O_CREAT</dt>

<dd>If the file exists, this flag has no effect except as noted under O_EXCL below. Otherwise, if O_DIRECTORY is not set the file
shall be created as a regular file; the user ID of the file shall be set to the effective user ID of the process; the group ID of
the file shall be set to the group ID of the file's parent directory or to the effective group ID of the process; and the access
permission bits (see <a href="../basedefs/sys_stat.h.html"><i>&lt;sys/stat.h&gt;</i></a>) of the file mode shall be set to the
value of the argument following the <i>oflag</i> argument taken as type <b>mode_t</b> modified as follows: a bitwise AND is
performed on the file-mode bits and the corresponding bits in the complement of the process' file mode creation mask. Thus, all
bits in the file mode whose corresponding bit in the file mode creation mask is set are cleared. When bits other than the file
permission bits are set, the effect is unspecified. The argument following the <i>oflag</i> argument does not affect whether the
file is open for reading, writing, or for both. Implementations shall provide a way to initialize the file's group ID to the group
ID of the parent directory. Implementations may, but need not, provide an implementation-defined way to initialize the file's group
ID to the effective group ID of the calling process.</dd>

<dt>O_DIRECTORY</dt>

<dd>If <i>path</i> resolves to a non-directory file, fail and set <i>errno</i> to [ENOTDIR].</dd>

<dt>O_DSYNC</dt>

<dd><sup>[<a href="javascript:open_code('SIO')">SIO</a>]</sup> <img src="../images/opt-start.gif" alt="[Option Start]" border="0">
Write I/O operations on the file descriptor shall complete as defined by synchronized I/O data integrity completion. <img src=
"../images/opt-end.gif" alt="[Option End]" border="0"></dd>

<dt>O_EXCL</dt>

<dd>If O_CREAT and O_EXCL are set, <i>open</i>() shall fail if the file exists. The check for the existence of the file and the
creation of the file if it does not exist shall be atomic with respect to other threads executing <i>open</i>() naming the same
filename in the same directory with O_EXCL and O_CREAT set. If O_EXCL and O_CREAT are set, and <i>path</i> names a symbolic link,
<i>open</i>() shall fail and set <i>errno</i> to [EEXIST], regardless of the contents of the symbolic link. If O_EXCL is set and
O_CREAT is not set, the result is undefined.</dd>

<dt>O_NOCTTY</dt>

<dd>If set and <i>path</i> identifies a terminal device, <i>open</i>() shall not cause the terminal device to become the
controlling terminal for the process. If <i>path</i> does not identify a terminal device, O_NOCTTY shall be ignored.</dd>

<dt>O_NOFOLLOW</dt>

<dd>If <i>path</i> names a symbolic link, fail and set <i>errno</i> to [ELOOP].</dd>

<dt>O_NONBLOCK</dt>

<dd>When opening a FIFO with O_RDONLY or O_WRONLY set: 

<ul>
<li>
<p>If O_NONBLOCK is set, an <i>open</i>() for reading-only shall return without delay. An <i>open</i>() for writing-only shall
return an error if no process currently has the file open for reading.</p>
</li>

<li>
<p>If O_NONBLOCK is clear, an <i>open</i>() for reading-only shall block the calling thread until a thread opens the file for
writing. An <i>open</i>() for writing-only shall block the calling thread until a thread opens the file for reading.</p>
</li>
</ul>

<p>When opening a block special or character special file that supports non-blocking opens:</p>

<ul>
<li>
<p>If O_NONBLOCK is set, the <i>open</i>() function shall return without blocking for the device to be ready or available.
Subsequent behavior of the device is device-specific.</p>
</li>

<li>
<p>If O_NONBLOCK is clear, the <i>open</i>() function shall block the calling thread until the device is ready or available before
returning.</p>
</li>
</ul>

<p>Otherwise, the O_NONBLOCK flag shall not cause an error, but it is unspecified whether the file status flags will include the
O_NONBLOCK flag.</p>
</dd>

<dt>O_RSYNC</dt>

<dd><sup>[<a href="javascript:open_code('SIO')">SIO</a>]</sup> <img src="../images/opt-start.gif" alt="[Option Start]" border="0">
Read I/O operations on the file descriptor shall complete at the same level of integrity as specified by the O_DSYNC and O_SYNC
flags. If both O_DSYNC and O_RSYNC are set in <i>oflag</i>, all I/O operations on the file descriptor shall complete as defined by
synchronized I/O data integrity completion. If both O_SYNC and O_RSYNC are set in flags, all I/O operations on the file descriptor
shall complete as defined by synchronized I/O file integrity completion. <img src="../images/opt-end.gif" alt="[Option End]"
border="0"></dd>

<dt>O_SYNC</dt>

<dd><sup>[<a href="javascript:open_code('XSI')">XSI|SIO</a>]</sup> <img src="../images/opt-start.gif" alt="[Option Start]" border=
"0"> Write I/O operations on the file descriptor shall complete as defined by synchronized I/O file integrity completion. <img src=
"../images/opt-end.gif" alt="[Option End]" border="0"> 

<p><sup>[<a href="javascript:open_code('XSI')">XSI</a>]</sup> <img src="../images/opt-start.gif" alt="[Option Start]" border="0">
The O_SYNC flag shall be supported for regular files, even if the Synchronized Input and Output option is not supported. <img src=
"../images/opt-end.gif" alt="[Option End]" border="0"></p>
</dd>

<dt>O_TRUNC</dt>

<dd>If the file exists and is a regular file, and the file is successfully opened O_RDWR or O_WRONLY, its length shall be truncated
to 0, and the mode and owner shall be unchanged. It shall have no effect on FIFO special files or terminal device files. Its effect
on other file types is implementation-defined. The result of using O_TRUNC without either O_RDWR or O_WRONLY is undefined.</dd>

<dt>O_TTY_INIT</dt>

<dd>If <i>path</i> identifies a terminal device other than a pseudo-terminal, the device is not already open in any process, and
either O_TTY_INIT is set in <i>oflag</i> or O_TTY_INIT has the value zero, <i>open</i>() shall set any non-standard <b>termios</b>
structure terminal parameters to a state that provides conforming behavior; see XBD <a href=
"../basedefs/V1_chap11.html#tag_11_02"><i>Parameters that Can be Set</i></a>. It is unspecified whether O_TTY_INIT has any effect
if the device is already open in any process. If <i>path</i> identifies the slave side of a pseudo-terminal that is not already
open in any process, <i>open</i>() shall set any non-standard <b>termios</b> structure terminal parameters to a state that provides
conforming behavior, regardless of whether O_TTY_INIT is set. If <i>path</i> does not identify a terminal device, O_TTY_INIT shall
be ignored.</dd>
</dl>

<p>If O_CREAT and O_DIRECTORY are set and the requested access mode is neither O_WRONLY nor O_RDWR, the result is unspecified.</p>

<p>If O_CREAT is set and the file did not previously exist, upon successful completion, <i>open</i>() shall mark for update the
last data access, last data modification, and last file status change timestamps of the file and the last data modification and
last file status change timestamps of the parent directory.</p>

<p>If O_TRUNC is set and the file did previously exist, upon successful completion, <i>open</i>() shall mark for update the last
data modification and last file status change timestamps of the file.</p>

<p><sup>[<a href="javascript:open_code('SIO')">SIO</a>]</sup> <img src="../images/opt-start.gif" alt="[Option Start]" border="0">
If both the O_SYNC and O_DSYNC flags are set, the effect is as if only the O_SYNC flag was set. <img src="../images/opt-end.gif"
alt="[Option End]" border="0"></p>

<p><sup>[<a href="javascript:open_code('OB XSR')">OB XSR</a>]</sup> <img src="../images/opt-start.gif" alt="[Option Start]" border=
"0"> If <i>path</i> refers to a STREAMS file, <i>oflag</i> may be constructed from O_NONBLOCK OR'ed with either O_RDONLY, O_WRONLY,
or O_RDWR. Other flag values are not applicable to STREAMS devices and shall have no effect on them. The value O_NONBLOCK affects
the operation of STREAMS drivers and certain functions applied to file descriptors associated with STREAMS files. For STREAMS
drivers, the implementation of O_NONBLOCK is device-specific. <img src="../images/opt-end.gif" alt="[Option End]" border="0"></p>

<p>The application shall ensure that it specifies the O_TTY_INIT flag on the first open of a terminal device since system boot or
since the device was closed by the process that last had it open. The application need not specify the O_TTY_INIT flag when opening
pseudo-terminals. <sup>[<a href="javascript:open_code('XSI')">XSI</a>]</sup> <img src="../images/opt-start.gif" alt=
"[Option Start]" border="0"> &nbsp;If <i>path</i> names the master side of a pseudo-terminal device, then it is unspecified whether
<i>open</i>() locks the slave side so that it cannot be opened. Conforming applications shall call <a href=
"../functions/unlockpt.html"><i>unlockpt</i>()</a> before opening the slave side. <img src="../images/opt-end.gif" alt=
"[Option End]" border="0"></p>

<p>The largest value that can be represented correctly in an object of type <b>off_t</b> shall be established as the offset maximum
in the open file description.</p>

<p>The <i>openat</i>() function shall be equivalent to the <i>open</i>() function except in the case where <i>path</i> specifies a
relative path. In this case the file to be opened is determined relative to the directory associated with the file descriptor
<i>fd</i> instead of the current working directory. If the access mode of the open file description associated with the file
descriptor is not O_SEARCH, the function shall check whether directory searches are permitted using the current permissions of the
directory underlying the file descriptor. If the access mode is O_SEARCH, the function shall not perform the check.</p>

<p>The <i>oflag</i> parameter and the optional fourth parameter correspond exactly to the parameters of <i>open</i>().</p>

<p>If <i>openat</i>() is passed the special value AT_FDCWD in the <i>fd</i> parameter, the current working directory shall be used
and the behavior shall be identical to a call to <i>open</i>().</p>
</blockquote>

<h4 class="mansect"><a name="tag_16_357_04"></a>RETURN VALUE</h4>

<blockquote>
<p>Upon successful completion, these functions shall open the file and return a non-negative integer representing the file
descriptor. Otherwise, these functions shall return -1 and set <i>errno</i> to indicate the error. If -1 is returned, no files
shall be created or modified.<br>
</p>
</blockquote>

<h4 class="mansect"><a name="tag_16_357_05"></a>ERRORS</h4>

<blockquote>
<p>These functions shall fail if:</p>

<dl compact>
<dt>[EACCES]</dt>

<dd>Search permission is denied on a component of the path prefix, or the file exists and the permissions specified by <i>oflag</i>
are denied, or the file does not exist and write permission is denied for the parent directory of the file to be created, or
O_TRUNC is specified and write permission is denied.</dd>

<dt>[EEXIST]</dt>

<dd>O_CREAT and O_EXCL are set, and the named file exists.</dd>

<dt>[EINTR]</dt>

<dd>A signal was caught during <i>open</i>().</dd>

<dt>[EINVAL]</dt>

<dd><sup>[<a href="javascript:open_code('SIO')">SIO</a>]</sup> <img src="../images/opt-start.gif" alt="[Option Start]" border="0">
The implementation does not support synchronized I/O for this file. <img src="../images/opt-end.gif" alt="[Option End]" border=
"0"></dd>

<dt>[EIO]</dt>

<dd><sup>[<a href="javascript:open_code('OB XSR')">OB XSR</a>]</sup> <img src="../images/opt-start.gif" alt="[Option Start]"
border="0"> The <i>path</i> argument names a STREAMS file and a hangup or error occurred during the <i>open</i>(). <img src=
"../images/opt-end.gif" alt="[Option End]" border="0"></dd>

<dt>[EISDIR]</dt>

<dd>The named file is a directory and <i>oflag</i> includes O_WRONLY or O_RDWR, or includes O_CREAT without O_DIRECTORY.</dd>

<dt>[ELOOP]</dt>

<dd>A loop exists in symbolic links encountered during resolution of the <i>path</i> argument, or O_NOFOLLOW was specified and the
<i>path</i> argument names a symbolic link.</dd>

<dt>[EMFILE]</dt>

<dd>All file descriptors available to the process are currently open.</dd>

<dt>[ENAMETOOLONG]</dt>

<dd>
The length of a component of a pathname is longer than {NAME_MAX}.</dd>

<dt>[ENFILE]</dt>

<dd>The maximum allowable number of files is currently open in the system.</dd>

<dt>[ENOENT]</dt>

<dd>O_CREAT is not set and a component of <i>path</i> does not name an existing file, or O_CREAT is set and a component of the path
prefix of <i>path</i> does not name an existing file, or <i>path</i> points to an empty string.</dd>

<dt>[ENOENT] or [ENOTDIR]</dt>

<dd>
O_CREAT is set, and the <i>path</i> argument contains at least one non- &lt;slash&gt; character and ends with one or more trailing
&lt;slash&gt; characters. If <i>path</i> without the trailing &lt;slash&gt; characters would name an existing file, an [ENOENT]
error shall not occur.</dd>

<dt>[ENOSR]</dt>

<dd><sup>[<a href="javascript:open_code('OB XSR')">OB XSR</a>]</sup> <img src="../images/opt-start.gif" alt="[Option Start]"
border="0"> The <i>path</i> argument names a STREAMS-based file and the system is unable to allocate a STREAM. <img src=
"../images/opt-end.gif" alt="[Option End]" border="0"></dd>

<dt>[ENOSPC]</dt>

<dd>The directory or file system that would contain the new file cannot be expanded, the file does not exist, and O_CREAT is
specified.</dd>

<dt>[ENOTDIR]</dt>

<dd>A component of the path prefix names an existing file that is neither a directory nor a symbolic link to a directory; or
O_CREAT and O_EXCL are not specified, the <i>path</i> argument contains at least one non- &lt;slash&gt; character and ends with one
or more trailing &lt;slash&gt; characters, and the last pathname component names an existing file that is neither a directory nor a
symbolic link to a directory; or O_DIRECTORY was specified and the <i>path</i> argument resolves to a non-directory file.</dd>

<dt>[ENXIO]</dt>

<dd>O_NONBLOCK is set, the named file is a FIFO, O_WRONLY is set, and no process has the file open for reading.</dd>

<dt>[ENXIO]</dt>

<dd>The named file is a character special or block special file, and the device associated with this special file does not
exist.</dd>

<dt>[EOVERFLOW]</dt>

<dd>The named file is a regular file and the size of the file cannot be represented correctly in an object of type
<b>off_t</b>.</dd>

<dt>[EROFS]</dt>

<dd>The named file resides on a read-only file system and either O_WRONLY, O_RDWR, O_CREAT (if the file does not exist), or O_TRUNC
is set in the <i>oflag</i> argument.</dd>
</dl>

<p>The <i>openat</i>() function shall fail if:</p>

<dl compact>
<dt>[EACCES]</dt>

<dd>The access mode of the open file description associated with <i>fd</i> is not O_SEARCH and the permissions of the directory
underlying <i>fd</i> do not permit directory searches.</dd>

<dt>[EBADF]</dt>

<dd>The <i>path</i> argument does not specify an absolute path and the <i>fd</i> argument is neither AT_FDCWD nor a valid file
descriptor open for reading or searching.</dd>

<dt>[ENOTDIR]</dt>

<dd>The <i>path</i> argument is not an absolute path and <i>fd</i> is a file descriptor associated with a non-directory file.</dd>
</dl>

<p>These functions may fail if:</p>

<dl compact>
<dt>[EAGAIN]</dt>

<dd><sup>[<a href="javascript:open_code('XSI')">XSI</a>]</sup> <img src="../images/opt-start.gif" alt="[Option Start]" border="0">
The <i>path</i> argument names the slave side of a pseudo-terminal device that is locked. <img src="../images/opt-end.gif" alt=
"[Option End]" border="0"></dd>

<dt>[EINVAL]</dt>

<dd>The value of the <i>oflag</i> argument is not valid.</dd>

<dt>[ELOOP]</dt>

<dd>More than {SYMLOOP_MAX} symbolic links were encountered during resolution of the <i>path</i> argument.</dd>

<dt>[ENAMETOOLONG]</dt>

<dd>
The length of a pathname exceeds {PATH_MAX}, or pathname resolution of a symbolic link produced an intermediate result with a
length that exceeds {PATH_MAX}.</dd>

<dt>[ENOMEM]</dt>

<dd><sup>[<a href="javascript:open_code('OB XSR')">OB XSR</a>]</sup> <img src="../images/opt-start.gif" alt="[Option Start]"
border="0"> The <i>path</i> argument names a STREAMS file and the system is unable to allocate resources. <img src=
"../images/opt-end.gif" alt="[Option End]" border="0"></dd>

<dt>[EOPNOTSUPP]</dt>

<dd>The <i>path</i> argument names a socket.</dd>

<dt>[ETXTBSY]</dt>

<dd>The file is a pure procedure (shared text) file that is being executed and <i>oflag</i> is O_WRONLY or O_RDWR.</dd>
</dl>
</blockquote>

<hr>
<div class="box"><em>The following sections are informative.</em></div>

<h4 class="mansect"><a name="tag_16_357_06"></a>EXAMPLES</h4>

<blockquote>
<h5><a name="tag_16_357_06_01"></a>Opening a File for Writing by the Owner</h5>

<p>The following example opens the file <b>/tmp/file</b>, either by creating it (if it does not already exist), or by truncating
its length to 0 (if it does exist). In the former case, if the call creates a new file, the access permission bits in the file mode
of the file are set to permit reading and writing by the owner, and to permit reading only by group members and others.</p>

<p>If the call to <i>open</i>() is successful, the file is opened for writing.</p>

<pre>
<tt>#include &lt;fcntl.h&gt;
...
int fd;
mode_t mode = S_IRUSR | S_IWUSR | S_IRGRP | S_IROTH;
char *pathname = "/tmp/file";
...
fd = open(pathname, O_WRONLY | O_CREAT | O_TRUNC, mode);
...
</tt>
</pre>

<h5><a name="tag_16_357_06_02"></a>Opening a File Using an Existence Check</h5>

<p>The following example uses the <i>open</i>() function to try to create the <b>LOCKFILE</b> file and open it for writing. Since
the <i>open</i>() function specifies the O_EXCL flag, the call fails if the file already exists. In that case, the program assumes
that someone else is updating the password file and exits.</p>

<pre>
<tt>#include &lt;fcntl.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
<br>
#define LOCKFILE "/etc/ptmp"
...
int pfd; /* Integer for file descriptor returned by open() call. */
...
if ((pfd = open(LOCKFILE, O_WRONLY | O_CREAT | O_EXCL,
    S_IRUSR | S_IWUSR | S_IRGRP | S_IROTH)) == -1)
{
    fprintf(stderr, "Cannot open /etc/ptmp. Try again later.\n");
    exit(1);
}
...
</tt>
</pre>

<h5><a name="tag_16_357_06_03"></a>Opening a File for Writing</h5>

<p>The following example opens a file for writing, creating the file if it does not already exist. If the file does exist, the
system truncates the file to zero bytes.</p>

<pre>
<tt>#include &lt;fcntl.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
<br>
#define LOCKFILE "/etc/ptmp"
...
int pfd;
char pathname[PATH_MAX+1];
...
if ((pfd = open(pathname, O_WRONLY | O_CREAT | O_TRUNC,
    S_IRUSR | S_IWUSR | S_IRGRP | S_IROTH)) == -1)
{
    perror("Cannot open output file\n"); exit(1);
}
...
</tt>
</pre>
</blockquote>

<h4 class="mansect"><a name="tag_16_357_07"></a>APPLICATION USAGE</h4>

<blockquote>
<p>POSIX.1-2017 does not require that terminal parameters be automatically set to any state on first open, nor that they be reset
after the last close. It is possible for a non-conforming application to leave a terminal device in a state where the next process
to use that device finds it in a non-conforming state, but has no way of determining this. To ensure that the device is set to a
conforming initial state, applications which perform a first open of a terminal (other than a pseudo-terminal) should do so using
the O_TTY_INIT flag to set the parameters associated with the terminal to a conforming state.</p>

<p>Except as specified in this volume of POSIX.1-2017, the flags allowed in <i>oflag</i> are not mutually-exclusive and any number
of them may be used simultaneously. Not all combinations of flags make sense. For example, using O_SEARCH | O_CREAT will
successfully open a pre-existing directory for searching, but if there is no existing file by that name, then it is unspecified
whether a regular file will be created. Likewise, if a non-directory file descriptor is successfully returned, it is unspecified
whether that descriptor will have execute permissions as if by O_EXEC (note that it is unspecified whether O_EXEC and O_SEARCH have
the same value).</p>
</blockquote>

<h4 class="mansect"><a name="tag_16_357_08"></a>RATIONALE</h4>

<blockquote>
<p>Some implementations permit opening FIFOs with O_RDWR. Since FIFOs could be implemented in other ways, and since two file
descriptors can be used to the same effect, this possibility is left as undefined.</p>

<p>See <a href="../functions/getgroups.html#"><i>getgroups</i></a> about the group of a newly created file.</p>

<p>The use of <i>open</i>() to create a regular file is preferable to the use of <a href=
"../functions/creat.html"><i>creat</i>()</a>, because the latter is redundant and included only for historical reasons.</p>

<p>The use of the O_TRUNC flag on FIFOs and directories (pipes cannot be <i>open</i>()-ed) must be permissible without unexpected
side-effects (for example, <a href="../functions/creat.html"><i>creat</i>()</a> on a FIFO must not remove data). Since terminal
special files might have type-ahead data stored in the buffer, O_TRUNC should not affect their content, particularly if a program
that normally opens a regular file should open the current controlling terminal instead. Other file types, particularly
implementation-defined ones, are left implementation-defined.</p>

<p>POSIX.1-2017 permits [EACCES] to be returned for conditions other than those explicitly listed.</p>

<p>The O_NOCTTY flag was added to allow applications to avoid unintentionally acquiring a controlling terminal as a side-effect of
opening a terminal file. This volume of POSIX.1-2017 does not specify how a controlling terminal is acquired, but it allows an
implementation to provide this on <i>open</i>() if the O_NOCTTY flag is not set and other conditions specified in XBD <a href=
"../basedefs/V1_chap11.html#tag_11"><i>General Terminal Interface</i></a> are met.</p>

<p>In historical implementations the value of O_RDONLY is zero. Because of that, it is not possible to detect the presence of
O_RDONLY and another option. Future implementations should encode O_RDONLY and O_WRONLY as bit flags so that:</p>

<pre>
<tt>O_RDONLY | O_WRONLY == O_RDWR
</tt>
</pre>

<p>O_EXEC and O_SEARCH are specified as two of the five file access modes. Since O_EXEC does not apply to directories, and O_SEARCH
only applies to directories, their values need not be distinct. Since O_RDONLY has historically had the value zero, implementations
are not able to distinguish between O_SEARCH and O_SEARCH | O_RDONLY, and similarly for O_EXEC.</p>

<p>In general, the <i>open</i>() function follows the symbolic link if <i>path</i> names a symbolic link. However, the
<i>open</i>() function, when called with O_CREAT and O_EXCL, is required to fail with [EEXIST] if <i>path</i> names an existing
symbolic link, even if the symbolic link refers to a nonexistent file. This behavior is required so that privileged applications
can create a new file in a known location without the possibility that a symbolic link might cause the file to be created in a
different location.</p>

<p>For example, a privileged application that must create a file with a predictable name in a user-writable directory, such as the
user's home directory, could be compromised if the user creates a symbolic link with that name that refers to a nonexistent file in
a system directory. If the user can influence the contents of a file, the user could compromise the system by creating a new system
configuration or spool file that would then be interpreted by the system. The test for a symbolic link which refers to a
nonexisting file must be atomic with the creation of a new file.</p>

<p>In addition, the <i>open</i>() function refuses to open non-directories if the O_DIRECTORY flag is set. This avoids race
conditions whereby a user might compromise the system by substituting a hard link to a sensitive file (e.g., a device or a FIFO)
while a privileged application is running, where opening a file even for read access might have undesirable side-effects.</p>

<p>In addition, the <i>open</i>() function does not follow symbolic links if the O_NOFOLLOW flag is set. This avoids race
conditions whereby a user might compromise the system by substituting a symbolic link to a sensitive file (e.g., a device) while a
privileged application is running, where opening a file even for read access might have undesirable side-effects.</p>

<p>The POSIX.1-1990 standard required that the group ID of a newly created file be set to the group ID of its parent directory or
to the effective group ID of the creating process. FIPS 151-2 required that implementations provide a way to have the group ID be
set to the group ID of the containing directory, but did not prohibit implementations also supporting a way to set the group ID to
the effective group ID of the creating process. Conforming applications should not assume which group ID will be used. If it
matters, an application can use <a href="../functions/chown.html"><i>chown</i>()</a> to set the group ID after the file is created,
or determine under what conditions the implementation will set the desired group ID.</p>

<p>The purpose of the <i>openat</i>() function is to enable opening files in directories other than the current working directory
without exposure to race conditions. Any part of the path of a file could be changed in parallel to a call to <i>open</i>(),
resulting in unspecified behavior. By opening a file descriptor for the target directory and using the <i>openat</i>() function it
can be guaranteed that the opened file is located relative to the desired directory. Some implementations use the <i>openat</i>()
function for other purposes as well. In some cases, if the <i>oflag</i> parameter has the O_XATTR bit set, the returned file
descriptor provides access to extended attributes. This functionality is not standardized here.</p>
</blockquote>

<h4 class="mansect"><a name="tag_16_357_09"></a>FUTURE DIRECTIONS</h4>

<blockquote>
<p>None.</p>
</blockquote>

<h4 class="mansect"><a name="tag_16_357_10"></a>SEE ALSO</h4>

<blockquote>
<p><a href="../functions/chmod.html#tag_16_58"><i>chmod</i></a>, <a href="../functions/close.html#"><i>close</i></a>, <a href=
"../functions/creat.html#"><i>creat</i></a>, <a href="../functions/dirfd.html#"><i>dirfd</i></a>, <a href=
"../functions/dup.html#"><i>dup</i></a>, <a href="../functions/exec.html#tag_16_111"><i><a href=
"../functions/exec.html">exec</a></i></a>, <a href="../functions/fcntl.html#"><i>fcntl</i></a>, <a href=
"../functions/fdopendir.html#"><i>fdopendir</i></a>, <a href="../functions/link.html#tag_16_293"><i>link</i></a>, <a href=
"../functions/lseek.html#"><i>lseek</i></a>, <a href="../functions/mkdtemp.html#"><i>mkdtemp</i></a>, <a href=
"../functions/mknod.html#"><i>mknod</i></a>, <a href="../functions/read.html#tag_16_474"><i>read</i></a>, <a href=
"../functions/symlink.html#"><i>symlink</i></a>, <a href="../functions/umask.html#tag_16_631"><i>umask</i></a>, <a href=
"../functions/unlockpt.html#"><i>unlockpt</i></a>, <a href="../functions/write.html#tag_16_685"><i>write</i></a></p>

<p>XBD <a href="../basedefs/V1_chap11.html#tag_11"><i>General Terminal Interface</i></a>, <a href=
"../basedefs/fcntl.h.html"><i>&lt;fcntl.h&gt;</i></a>, <a href="../basedefs/sys_stat.h.html"><i>&lt;sys/stat.h&gt;</i></a>, <a
href="../basedefs/sys_types.h.html"><i>&lt;sys/types.h&gt;</i></a></p>
</blockquote>

<h4 class="mansect"><a name="tag_16_357_11"></a>CHANGE HISTORY</h4>

<blockquote>
<p>First released in Issue 1. Derived from Issue 1 of the SVID.</p>
</blockquote>

<h4 class="mansect"><a name="tag_16_357_12"></a>Issue 5</h4>

<blockquote>
<p>The DESCRIPTION is updated for alignment with the POSIX Realtime Extension and the POSIX Threads Extension.</p>

<p>Large File Summit extensions are added.</p>
</blockquote>

<h4 class="mansect"><a name="tag_16_357_13"></a>Issue 6</h4>

<blockquote>
<p>In the SYNOPSIS, the optional include of the <a href="../basedefs/sys_types.h.html"><i>&lt;sys/types.h&gt;</i></a> header is
removed.</p>

<p>The following new requirements on POSIX implementations derive from alignment with the Single UNIX Specification:</p>

<ul>
<li>
<p>The requirement to include <a href="../basedefs/sys_types.h.html"><i>&lt;sys/types.h&gt;</i></a> has been removed. Although <a
href="../basedefs/sys_types.h.html"><i>&lt;sys/types.h&gt;</i></a> was required for conforming implementations of previous POSIX
specifications, it was not required for UNIX applications.</p>
</li>

<li>
<p>In the DESCRIPTION, O_CREAT is amended to state that the group ID of the file is set to the group ID of the file's parent
directory or to the effective group ID of the process. This is a FIPS requirement.</p>
</li>

<li>
<p>In the DESCRIPTION, text is added to indicate setting of the offset maximum in the open file description. This change is to
support large files.</p>
</li>

<li>
<p>In the ERRORS section, the [EOVERFLOW] condition is added. This change is to support large files.</p>
</li>

<li>
<p>The [ENXIO] mandatory error condition is added.</p>
</li>

<li>
<p>The [EINVAL], [ENAMETOOLONG], and [ETXTBSY] optional error conditions are added.</p>
</li>
</ul>

<p>The DESCRIPTION and ERRORS sections are updated so that items related to the optional XSI STREAMS Option Group are marked.</p>

<p>The following changes were made to align with the IEEE&nbsp;P1003.1a draft standard:</p>

<ul>
<li>
<p>An explanation is added of the effect of the O_CREAT and O_EXCL flags when the path refers to a symbolic link.</p>
</li>

<li>
<p>The [ELOOP] optional error condition is added.</p>
</li>
</ul>

<p>The normative text is updated to avoid use of the term &quot;must&quot; for application requirements.</p>

<p>The DESCRIPTION of O_EXCL is updated in response to IEEE PASC Interpretation 1003.1c #48.</p>
</blockquote>

<h4 class="mansect"><a name="tag_16_357_14"></a>Issue 7</h4>

<blockquote>
<p>Austin Group Interpretations 1003.1-2001 #113 and #143 are applied.</p>

<p>Austin Group Interpretation 1003.1-2001 #144 is applied, adding the O_TTY_INIT flag.</p>

<p>Austin Group Interpretation 1003.1-2001 #171 is applied, adding support to set the FD_CLOEXEC flag atomically at <i>open</i>(),
and adding the F_DUPFD_CLOEXEC flag.</p>

<p>SD5-XBD-ERN-4 is applied, changing the definition of the [EMFILE] error.</p>

<p>This page is revised and the <i>openat</i>() function is added from The Open Group Technical Standard, 2006, Extended API Set
Part 2.</p>

<p>Functionality relating to the XSI STREAMS option is marked obsolescent.</p>

<p>Changes are made related to support for finegrained timestamps.</p>

<p>Changes are made to allow a directory to be opened for searching.</p>

<p>POSIX.1-2008, Technical Corrigendum 1, XSH/TC1-2008/0418 [292], XSH/TC1-2008/0419 [141], XSH/TC1-2008/0420 [461],
XSH/TC1-2008/0421 [390], XSH/TC1-2008/0422 [146], XSH/TC1-2008/0423 [324], XSH/TC1-2008/0424 [292], XSH/TC1-2008/0425 [278],
XSH/TC1-2008/0426 [278], XSH/TC1-2008/0427 [291], and XSH/TC1-2008/0428 [307] are applied.</p>

<p>POSIX.1-2008, Technical Corrigendum 2, XSH/TC2-2008/0235 [873], XSH/TC2-2008/0236 [835], XSH/TC2-2008/0237 [847],
XSH/TC2-2008/0238 [817], XSH/TC2-2008/0239 [835], XSH/TC2-2008/0240 [847], XSH/TC2-2008/0241 [822], XSH/TC2-2008/0242 [817], and
XSH/TC2-2008/0243 [943] are applied.</p>
</blockquote>

<div class="box"><em>End of informative text.</em></div>

<hr>
<p>&nbsp;</p>

<a href="#top"><span class="topOfPage">return to top of page</span></a><br>
<hr size="2" noshade>
<center><font size="2">UNIX &reg; is a registered Trademark of The Open Group.<br>
POSIX &reg; is a registered Trademark of The IEEE.<br>
Copyright &copy; 2001-2018 IEEE and The Open Group, All Rights Reserved<br>
[ <a href="../mindex.html">Main Index</a> | <a href="../basedefs/contents.html">XBD</a> | <a href=
"../functions/contents.html">XSH</a> | <a href="../utilities/contents.html">XCU</a> | <a href="../xrat/contents.html">XRAT</a>
]</font></center>

<hr size="2" noshade>
<div class="NAVHEADER">
<table summary="Header navigation table" class="nav" width="100%" border="0" cellpadding="0" cellspacing="0">
<tr class="nav">
<td class="nav" width="15%" align="left" valign="bottom"><a href="../functions/nl_langinfo.html" accesskey="P">&lt;&lt;&lt;
Previous</a></td>
<td class="nav" width="70%" align="center" valign="bottom"><a href="contents.html">Home</a></td>
<td class="nav" width="15%" align="right" valign="bottom"><a href="../functions/open_memstream.html" accesskey="N">Next
&gt;&gt;&gt;</a></td>
</tr>
</table>

<hr align="LEFT" width="100%">
</div>
</body>
</html>

